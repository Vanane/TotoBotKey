build: clean
# Getting a copy of README.md to include it into the package
	cp ../../README.md ./README.md	
	cd totoBotKey && python3 _dump_keys.py build
	python3 -m build

pub: publish
publish:
	branch = $$(git branch --show-current)						;\
	git stash -m "Stashing for publishing"						;\
	git checkout main											;\
	make build													;\
	python3 -m twine upload dist/*								;\
	git checkout $$branch										;\
	git stash pop												;\

# Install built packages in the local venv
install:
	find dist/*.whl	
	python3 -m pip install dist/*.whl --force-reinstall

clean:
# '-' discards errors
# Temporary README
	- rm README.md
# Twine directories
	- rm -rf ./dist
# egg-info, idk
	- rm -rf ./TotoBotKey.egg-info
# Python cache
	- for f in $$(find -name *__pycache__); do rm -rf "$$f"; done
# keys dump generated by TotoBotKey
	- for f in $$(find -name *input-event-codes.h); do rm -f "$$f"; done
	python3 ./totoBotKey/_dump_keys.py clean
